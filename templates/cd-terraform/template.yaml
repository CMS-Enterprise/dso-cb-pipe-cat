version: 1
type: pipeline-template
templateType: MULTIBRANCH
name: terraform Pipeline Job
description: Simple CD with IAC Terraform
parameters:
  - name: emailRecipient
    type: string
    displayName: Email address to be used for sending build notifications
  - name: github_repo
    type: string
    displayName: GitHub HTTPS repo endpoint
  - name: artifact_name
    type: string
    displayName: Name of your artifact in Artifactory
  - name: artifactory_project_name
    type: string
    displayName: Name of your project in Artifactory
  - name: build_args
    type: string
    displayName: Terraform Bulid arguments
  - name: test_args
    type: string
    displayName: Terraform Test arguments
  - name: gh_org
    type: string
    displayName: Name of your Github Org
  - name: aws_role_arn
    type: string
    default: arn:aws:iam::280350076387:role/delegatedadmin/developer/jenkins-role
    displayName: Provide AWS service account role arn
  - name: work_directory
    type: string
    displayName: Name of the working directory
  - name: tf_var_file
    type: string
    displayName: Path and name of the tf var files
  - name: backend_config_file
    type: string
    displayName: Path and name of the backend config file
   
multibranch:
  branchSource:
    # git:
      # remote: ${github_repo}
    github:
      repoOwner: ${gh_org}
      repository: ${github_repo}
      credentialsId: "git_token"
  orphanedItemStrategy:
    daysToKeep: 3