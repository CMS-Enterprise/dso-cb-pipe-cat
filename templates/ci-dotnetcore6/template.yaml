version: 1
type: pipeline-template
templateType: MULTIBRANCH
name: dotNet Core 6 Pipeline Job
description: Simple dotnetcore 6 App
parameters:
  - name: emailRecipient
    type: string
    displayName: Email address to be used for sending build notifications
  - name: github_repo
    type: string
    displayName: GitHub HTTPS repo endpoint
  - name: artifact_name
    type: string
    displayName: Name of your artifact in Artifactory
  - name: artifactory_project_name
    type: string
    displayName: Name of your project in Artifactory
  - name: build_args
    type: string
    displayName: dotnet Build arguments
  - name: test_args
    type: string
    displayName: dotnet Test arguments
  - name: gh_org
    type: string
    displayName: Name of your Github Org
  - name: sq_project_key
    type: string
    displayName: Sonarqube project key
  - name: org_id
    type: string
    displayName: Snyk org id
  - name: docker_args
    type: string
    displayName: Docker arguments
  - name: artifactory_path
    type: string
    displayName: Path to Artifact in Artifactory 
  - name: work_directory
    type: string
    displayName: Name of the working directory
  - name: docker_file
    type: string
    displayName: Name of the Docker file
   
multibranch:
  branchSource:
    git:
      remote: 'https://github.com/${gh_org}/${github_repo}.git'
      credentialsId: "git_token"
      traits:
        - $class: "jenkins.plugins.git.traits.BranchDiscoveryTrait"
        - $class: "jenkins.plugins.git.traits.CleanBeforeCheckoutTrait"
        - $class: "jenkins.scm.impl.trait.RegexSCMHeadFilterTrait"
          regex: 'dotnetcore6-std'
    strategy:
      $class: NamedExceptionsBranchPropertyStrategy
      defaultProperties:
        - $class: NoTriggerBranchProperty
    # git:
    #   remote: 'https://github.com/${gh_org}/${github_repo}.git'
    #   credentialsId: 'git_token'
    #   traits:
    #     - gitBranchDiscovery
    #     - $class: DiscoverOtherRefsTrait
    #       ref: 'refs/heads/dotnetcore6-std'
    #     - cleanBeforeCheckout
    #     - $class: GitBrowserSCMSourceTrait
  # branchSource:
  #   fromScm:
  #     name: ''
  #     scm:
  #       scmGit:
  #         userRemoteConfigs:
  #         - userRemoteConfig:
  #             credentialsId: "git_token"
  #             url: https://github.com/${gh_org}/${github_repo}
  #         branches:
  #         - branchSpec:
  #             name: 'dotnetcore6.6-std'     
  orphanedItemStrategy:
    daysToKeep: 3